# smart_pack.sh - 智能压缩打包工具

## 功能概述

`smart_pack.sh` 是一个智能的目录压缩打包脚本，能够自动扫描当前目录下的子目录，按照磁盘占用大小排序后进行压缩打包，并提供详细的日志记录和状态汇总。

## 主要特性

- **智能排序**：按磁盘占用大小升序处理目录
- **双模式打包**：主流程打包 + other打包模式
- **灵活排除**：支持文件模式和目录排除
- **日志记录**：详细的操作日志和时间戳
- **状态跟踪**：完整的任务状态汇总
- **错误处理**：完善的错误检测和处理机制

## 使用方法

```bash
./smart_pack.sh
```

## 打包规则

### 主流程打包
- 扫描当前目录下所有子目录（按磁盘占用排序）
- 排除指定的文件模式和目录
- 为每个目录生成独立的 `.tar.gz` 压缩包
- 压缩包命名格式：`{父目录名}.{当前目录名}.{目录名}.{时间戳}.tar.gz`

### Other打包
- 包含未被主流程处理的文件和目录
- 排除主流程已成功打包的压缩包
- 生成单独的 `other` 压缩包

## 排除规则

### 主流程排除的文件模式
> 在`MAIN_EXCLUDE_PATTERNS`中配置，如下：
```bash
*.txt
*.sh
*.zip
smart_pack.sh
pack_*.log
```

### 主流程跳过的目录
> 在`MAIN_SKIP_DIRS`中配置，如下：
```bash
logs
.pki
.oracle_jre_usage
```

### Other排除的文件模式
> 在`OTHER_EXCLUDE_PATTERNS`中配置，如下：
```bash
smart_pack.sh
pack_*.log
*.tmp
*.swp
*.log
```

### Other跳过的目录
> 在`OTHER_SKIP_DIRS`中配置，如下：
```bash
logs
```

## 输出结果

### 日志文件
每次执行会生成带时间戳的日志文件：`pack_YYYYMMDD_HHMMSS.log`

### 状态汇总
执行完成后显示详细的状态汇总，包括：
- ✅ 成功打包的目录
- ❌ 打包失败的目录  
- ⏭️  跳过的目录
- 📁 other包含的内容
- 🗑️  other跳过的主流程压缩包

## 错误处理

- 如果无法进入指定目录，脚本会立即退出
- 每个目录的打包操作都有独立的错误检测
- 失败的打包会被记录但不会中断整个流程
- 详细的错误信息会写入日志文件

## 注意事项

1. 脚本需要在bash环境下运行
2. 确保有足够的磁盘空间进行压缩操作
3. 日志文件会保存在当前目录下
4. 时间戳格式为：`YYYYMMDDHHMM`
5. 压缩包会覆盖同名文件（如果存在）

## 示例输出

```
2024-12-19 10:30:15 - 🔍 扫描子目录并按磁盘占用排序...
2024-12-19 10:30:15 - 📦 共发现 5 个目录待处理: dir1 dir2 dir3 dir4 dir5
2024-12-19 10:30:15 - 🚀 开始逐个打包目录（按大小升序）...
2024-12-19 10:30:16 - 🔄 正在打包: dir1
2024-12-19 10:30:18 - ✅ 打包成功: parent.current.dir1.202412191030.tar.gz
...
```